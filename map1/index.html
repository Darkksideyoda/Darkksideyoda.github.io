<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <title>Indoor Maps App YENI</title>
    
    <link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css" type="text/css" />
    <link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/indoor/0.1/atlas-indoor.min.css" type="text/css"/>

    <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js"></script>
    <script src="https://atlas.microsoft.com/sdk/javascript/indoor/0.1/atlas-indoor.min.js"></script>
      
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
      }

      #map-id {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <div id="map-id"></div>
    <script>
      const subscriptionKey = "WEXP8-PCqDdryQh6kHw_TPwIejLvcTHp--JLFdYrCKI";
      const tilesetId = "5a002a75-5de9-ecb7-8de3-b61e663fa201";
      const statesetId = "350a1ba0-46d1-4f28-604f-658950ee03cc";

      const map = new atlas.Map("map-id", {
        //use your facility's location
        center: [-122.13203, 47.63645],
        //or, you can use bounds: [# west, # south, # east, # north] and replace # with your Map bounds
        style: "blank",
        view: 'Auto',
        authOptions: { 
            authType: 'subscriptionKey',
            subscriptionKey: subscriptionKey
        },
        zoom: 19,
      });

      const levelControl = new atlas.control.LevelControl({
        position: "top-right",
      });

      const indoorManager = new atlas.indoor.IndoorManager(map, {
        levelControl: levelControl, //level picker
        tilesetId: tilesetId,
        statesetId: statesetId,
        geography :"eu"
      });
;

      if (statesetId.length > 0) {
        indoorManager.setDynamicStyling(true);
      }

      map.events.add("levelchanged", indoorManager, (eventData) => {
        //put code that runs after a level has been changed
        console.log("The level has changed:", eventData);
        writeToInfoPanel('The level has changed:', eventData);

      });

      map.events.add("facilitychanged", indoorManager, (eventData) => {
        //put code that runs after a facility has been changed
        console.log("The facility has changed:", eventData);
        writeToInfoPanel('The facility has changed:', eventData);

      });



      map.events.add("click", function (e) {

var features = map.layers.getRenderedShapes(e.position, 'unit');

writeToInfoPanel('Feature(s) clicked:', features);

features.forEach(function (feature) {
    if (feature.layer.id == 'indoor_unit_office') {
        console.log(feature);
    }
});
});

function writeToInfoPanel(msg, json) {            
            document.getElementById('infoPanel-msg').innerHTML = msg;

            //Remove "map" object from json to prevent circular reference, and format JSON string.
            document.getElementById('infoPanel-json').value = JSON.stringify(Object.assign({}, json, { map: undefined }), null, '\t').replace(/\"([^(\")"]+)\":/g, "$1:");
        }

      
      
    </script>

<div id="myMap" style="position:relative;width:100%;min-width:290px;height:600px;"></div>

    <div id="infoPanel" style="position:absolute;top:10px;left:10px;width:260px;height:580px;border:solid 1px #000;background-color:white;padding:5px;">
        <div id="infoPanel-msg"></div>
        <textarea id="infoPanel-json" style="width:250px;height:550px;white-space:nowrap"></textarea>
    </div>

    <fieldset style="width:calc(100% - 30px);min-width:290px;margin-top:10px;">
        <legend>Creator indoor maps</legend>
        This is a demo of the <a href="https://docs.microsoft.com/en-us/azure/azure-maps/tutorial-creator-indoor-maps">Azure Maps Creator indoor maps tutorial</a> and the <a href="https://docs.microsoft.com/en-us/azure/azure-maps/how-to-use-indoor-module">how-to implementation for the Azure Maps Web SDK</a>.
        Click on the facility to make the level picker appear.
    </fieldset>


  </body>
</html>
